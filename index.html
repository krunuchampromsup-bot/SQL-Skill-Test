<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL VIEW Master Class - T.Nuch Smart Com</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #1e40af;
            --secondary: #64748b;
            --accent: #10b981;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #1e293b;
            --syntax-bg: #1e293b;
            --border: #e2e8f0;
            --gold: #f59e0b;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            line-height: 1.6;
        }

        .container { max-width: 900px; margin: auto; padding: 40px 20px; }

        .edu-header { text-align: center; margin-bottom: 30px; }
        .edu-header h1 { color: var(--primary); font-size: 2.2rem; margin: 0; }

        .box {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid var(--border);
            animation: fadeIn 0.5s ease;
        }

        .tab-container {
            display: flex; gap: 5px; margin-bottom: 20px;
            background: #e2e8f0; padding: 5px; border-radius: 10px;
        }
        .tab-btn {
            flex: 1; padding: 10px; border: none; background: none;
            font-family: 'Prompt'; cursor: pointer; border-radius: 8px;
            transition: 0.3s; color: var(--secondary); font-weight: 500;
        }
        .tab-btn.active { background: var(--primary); color: white; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .syntax-box {
            background: var(--syntax-bg); padding: 20px; border-radius: 10px;
            border-left: 5px solid var(--primary); font-family: 'Consolas', monospace;
            color: #e2e8f0; line-height: 1.5; margin: 15px 0;
        }

        .keyword { color: #f472b6; font-weight: bold; }
        .variable { color: #60a5fa; }

        .table-sim {
            width: 100%; border-collapse: collapse; margin: 15px 0;
            background: white; border-radius: 8px; overflow: hidden;
            font-size: 0.9rem; border: 1px solid var(--border);
        }
        .table-sim th { background: #f8fafc; color: var(--primary); padding: 12px; text-align: left; border-bottom: 2px solid var(--border); }
        .table-sim td { padding: 12px; border-bottom: 1px solid var(--border); }

        .btn {
            padding: 12px 25px; border-radius: 8px; border: none;
            font-family: 'Prompt'; font-weight: 600; cursor: pointer; transition: 0.3s;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary { background: var(--primary); color: white; width: 100%; }
        .btn-success { background: var(--accent); color: white; margin-top: 10px; }
        .btn-secondary { background: var(--secondary); color: white; margin-top: 10px; }

        input[type="text"], textarea {
            width: 100%; padding: 12px; border-radius: 8px;
            border: 2px solid var(--border); margin: 10px 0; font-family: 'Prompt', sans-serif; 
            box-sizing: border-box; font-size: 1rem; outline: none;
        }
        textarea { font-family: 'Consolas', monospace; height: 100px; }
        input:focus, textarea:focus { border-color: var(--primary); }

        .feedback { margin-top: 15px; padding: 15px; border-radius: 8px; display: none; }
        .feedback.correct { background: #f0fdf4; color: #166534; display: block; border: 1px solid #bbf7d0; }
        .feedback.wrong { background: #fef2f2; color: #991b1b; display: block; border: 1px solid #fecaca; }

        .leaderboard-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .leaderboard-table th { background: var(--primary); color: white; padding: 15px; }
        .leaderboard-table td { padding: 15px; border-bottom: 1px solid var(--border); text-align: center; }
        .highlight-row { background: #f0fdf4; font-weight: bold; }

        .score-badge { background: var(--gold); color: white; padding: 2px 10px; border-radius: 20px; font-size: 0.9rem; }

        .hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ระบบจับเวลาและปุ่ม Reset */
        .timer-container {
            background: #fee2e2;
            color: #ef4444;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid #fecaca;
        }
        .timer-bar {
            height: 4px;
            background: #ef4444;
            width: 100%;
            position: absolute;
            bottom: 0;
            left: 0;
            transition: width 1s linear;
        }
        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: #f8fafc;
            padding: 10px;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        .btn-reset {
            background: #f1f5f9;
            color: #64748b;
            font-size: 0.8rem;
            padding: 5px 10px;
            border: 1px solid #cbd5e1;
            cursor: pointer;
            border-radius: 5px;
        }
        .btn-reset:hover { background: #e2e8f0; color: #ef4444; }
    </style>
</head>
<body>

<div class="container">
    <div class="edu-header">
        <h1><i class="fas fa-database"></i> SQL VIEW Master Class</h1>
        <p>บทเรียนโต้ตอบ: สร้างและจัดการตารางเสมือน โดย ครูนุช Smart Com</p>
    </div>

    <div id="lesson-area" class="box">
        <div class="tab-container">
            <button class="tab-btn active" onclick="openTab(event, 'tab-create')">VIEW TABLE</button>
            <button class="tab-btn" onclick="openTab(event, 'tab-insert')">INSERT VIEW</button>
            <button class="tab-btn" onclick="openTab(event, 'tab-update')">UPDATE VIEW</button>
            <button class="tab-btn" onclick="openTab(event, 'tab-delete')">DELETE VIEW</button>
        </div>

        <div id="tab-create" class="tab-content active">
            <h2>1. รูปแบบคำสั่งการสร้าง VIEW</h2>
            <p>VIEW คือตารางเสมือนที่สร้างจากคำสั่ง SELECT เพื่อช่วยให้การจัดการข้อมูลง่ายขึ้น</p>
            <div class="syntax-box">
                <span class="keyword">CREATE VIEW</span> <span class="variable">view_name</span> <span class="keyword">AS</span><br>
                <span class="keyword">SELECT</span> column1, column2, ...<br>
                <span class="keyword">FROM</span> table_name<br>
                <span class="keyword">WHERE</span> condition;
            </div>
            <div style="margin-top:20px;">
                <p><strong>ตัวอย่าง:</strong> สร้าง View พนักงานแผนก IT</p>
                <div class="syntax-box" style="border-left-color: var(--accent);">
                    CREATE VIEW it_staff AS SELECT name, salary FROM employees WHERE dept = 'IT';
                </div>
            </div>
        </div>
        <button class="btn btn-primary" onclick="showLogin()" style="margin-top:20px;">
            <i class="fas fa-edit"></i> เตรียมตัวทำแบบทดสอบ
        </button>
    </div>

    <div id="login-area" class="box hidden">
        <h2 style="text-align:center; color: var(--primary);">ลงทะเบียนผู้เข้าเรียน</h2>
        <div style="max-width: 400px; margin: auto;">
            <label>ชื่อ-นามสกุล:</label>
            <input type="text" id="student-name" placeholder="ระบุชื่อ-นามสกุล">
            <label>เลขที่:</label>
            <input type="text" id="student-no" placeholder="ระบุเลขที่">
            <button class="btn btn-primary" onclick="startQuiz()" style="margin-top:15px;">
                เข้าสู่โหมดภารกิจ <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <div id="quiz-area" class="hidden">
        <div class="box">
            <div class="quiz-controls">
                <div style="display:flex; align-items: center; gap: 15px;">
                    <h2 style="color:var(--primary); margin:0;"><i class="fas fa-code"></i> Mission <span id="q-number">1</span></h2>
                    <button class="btn-reset" onclick="confirmReset()">
                        <i class="fas fa-sync-alt"></i> Reset คะแนน
                    </button>
                </div>
                
                <div style="display:flex; gap: 10px; align-items: center;">
                    <div class="timer-container">
                        <i class="fas fa-clock"></i> <span id="time-left">30</span>s
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight:bold; font-size: 0.9rem;"><span id="display-user"></span> (เลขที่ <span id="display-no"></span>)</div>
                        <div class="score-badge">Score: <span id="current-score">0</span></div>
                    </div>
                </div>
                <div id="timer-bar" class="timer-bar"></div>
            </div>

            <div id="q-container">
                <div id="question-text" style="font-size: 1.1rem; margin-bottom: 15px; background: #fffbeb; padding: 15px; border-radius: 8px; border-left: 5px solid var(--gold);"></div>
                
                <div id="table-preview" class="hidden">
                    <p><small><i class="fas fa-table"></i> ตารางอ้างอิง:</small></p>
                    <table class="table-sim" id="simulated-result"></table>
                </div>

                <textarea id="sql-input" placeholder="พิมพ์คำสั่ง SQL ที่นี่..."></textarea>
                <div id="feedback-msg" class="feedback"></div>

                <div style="display: flex; gap: 10px;">
                    <button id="run-btn" class="btn btn-success" style="flex: 2;" onclick="processAnswer()">
                        <i class="fas fa-play"></i> Run Command
                    </button>
                    <button id="skip-btn" class="btn btn-secondary" style="flex: 1;" onclick="nextQuestion()">
                        ข้ามข้อนี้ <i class="fas fa-forward"></i>
                    </button>
                </div>

                <button id="next-btn" class="btn btn-primary hidden" onclick="nextQuestion()" style="margin-top:20px;">
                    Next Mission <i class="fas fa-arrow-right"></i>
                </button>
                <button id="finish-btn" class="btn btn-primary hidden" onclick="showResults()" style="margin-top:20px; background: var(--accent);">
                    <i class="fas fa-check-double"></i> ดูสรุปคะแนน
                </button>
            </div>
        </div>
    </div>

    <div id="result-screen" class="hidden">
        <div class="box" style="text-align: center;">
            <h2 style="color: var(--primary);"><i class="fas fa-award"></i> สรุปผลการทดสอบ</h2>
            <div style="font-size: 5rem; color: var(--accent); font-weight: bold; margin: 10px 0;" id="final-score-val">0</div>
            <p id="congrats-text" style="font-size: 1.2rem;"></p>
        </div>

        <div class="box">
            <h2 style="text-align: center; color: var(--gold); margin-bottom: 20px;">
                <i class="fas fa-trophy"></i> Classroom Leaderboard
            </h2>
            <table class="leaderboard-table">
                <thead>
                    <tr><th>Rank</th><th>เลขที่</th><th>ชื่อ-นามสกุล</th><th>Score</th></tr>
                </thead>
                <tbody id="leaderboard-body"></tbody>
            </table>
            <button class="btn btn-primary" style="margin-top:30px;" onclick="location.reload()">
                <i class="fas fa-redo"></i> กลับไปทบทวนบทเรียน
            </button>
        </div>
    </div>
</div>

<script>
    let currentQ = 0;
    let score = 0;
    let studentData = { name: "", no: "" };
    let timeLeft = 30;
    let timerInterval;

    const questions = [
        { task: "จงสร้าง VIEW ชื่อ <b>active_users</b> จากตาราง <b>users</b> โดยเลือกทุกคอลัมน์ที่ status = 'active'", answer: "CREATE VIEW active_users AS SELECT * FROM users WHERE status = 'active';", table: "<tr><th>id</th><th>name</th><th>status</th></tr><tr><td>1</td><td>Somsak</td><td>active</td></tr>" },
        { task: "จงเขียนคำสั่งเรียกดูข้อมูลทั้งหมดจาก VIEW ที่ชื่อ <b>active_users</b>", answer: "SELECT * FROM active_users;", table: "<tr><th>id</th><th>name</th><th>status</th></tr><tr><td>1</td><td>Somsak</td><td>active</td></tr>" },
        { task: "จงสร้าง VIEW ชื่อ <b>high_price</b> จากตาราง <b>products</b> เลือกทุกคอลัมน์ที่ price > 1000", answer: "CREATE VIEW high_price AS SELECT * FROM products WHERE price > 1000;", table: "<tr><th>p_id</th><th>name</th><th>price</th></tr><tr><td>101</td><td>Monitor</td><td>4500</td></tr>" },
        { task: "จงเพิ่มข้อมูลชื่อ <b>'Notebook'</b> ราคา <b>25000</b> ลงใน VIEW ชื่อ <b>high_price</b>", answer: "INSERT INTO high_price (name, price) VALUES ('Notebook', 25000);" },
        { task: "จงแก้ไขราคาใน VIEW <b>high_price</b> เป็น <b>1500</b> สำหรับสินค้าที่มี <b>id = 5</b>", answer: "UPDATE high_price SET price = 1500 WHERE id = 5;" },
        { task: "จงลบข้อมูลออกจาก VIEW <b>active_users</b> สำหรับผู้ใช้ที่มี <b>id = 10</b>", answer: "DELETE FROM active_users WHERE id = 10;" },
        { task: "หากต้องการลบตารางเสมือน <b>active_users</b> ออกจากระบบ ต้องใช้คำสั่งใด", answer: "DROP VIEW active_users;" },
        { task: "จงสร้าง VIEW ชื่อ <b>staff_list</b> โดยเลือกเฉพาะคอลัมน์ <b>name</b> จาก <b>employees</b>", answer: "CREATE VIEW staff_list AS SELECT name FROM employees;", table: "<tr><th>name</th></tr><tr><td>John</td></tr>" },
        { task: "จงเรียกดูข้อมูลจาก VIEW <b>staff_list</b> โดยเรียงชื่อตามตัวอักษร", answer: "SELECT * FROM staff_list ORDER BY name;" },
        { task: "จงใช้คำสั่งลบตารางเสมือน <b>high_price</b> ออกจากระบบ", answer: "DROP VIEW high_price;" }
    ];

    function openTab(evt, tabName) {
        let content = document.getElementsByClassName("tab-content");
        for (let i = 0; i < content.length; i++) content[i].classList.remove("active");
        let btns = document.getElementsByClassName("tab-btn");
        for (let i = 0; i < btns.length; i++) btns[i].classList.remove("active");
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
    }

    function showLogin() {
        document.getElementById('lesson-area').classList.add('hidden');
        document.getElementById('login-area').classList.remove('hidden');
    }

    function startQuiz() {
        const name = document.getElementById('student-name').value.trim();
        const no = document.getElementById('student-no').value.trim();
        if (!name || !no) { alert("กรุณากรอกชื่อและเลขที่ครับ"); return; }
        studentData.name = name; studentData.no = no;
        document.getElementById('display-user').innerText = name;
        document.getElementById('display-no').innerText = no;
        document.getElementById('login-area').classList.add('hidden');
        document.getElementById('quiz-area').classList.remove('hidden');
        loadQuestion();
    }

    function loadQuestion() {
        clearInterval(timerInterval);
        const q = questions[currentQ];
        document.getElementById('q-number').innerText = currentQ + 1;
        document.getElementById('question-text').innerHTML = q.task;
        
        if (q.table) {
            document.getElementById('table-preview').classList.remove('hidden');
            document.getElementById('simulated-result').innerHTML = q.table;
        } else {
            document.getElementById('table-preview').classList.add('hidden');
        }

        document.getElementById('sql-input').value = "";
        document.getElementById('sql-input').disabled = false;
        document.getElementById('feedback-msg').style.display = "none";
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('run-btn').classList.remove('hidden');
        document.getElementById('skip-btn').classList.remove('hidden');
        document.getElementById('finish-btn').classList.add('hidden');
        startTimer();
    }

    function startTimer() {
        timeLeft = 30;
        updateTimerDisplay();
        timerInterval = setInterval(() => {
            timeLeft--;
            updateTimerDisplay();
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                timeOut();
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        document.getElementById('time-left').innerText = timeLeft;
        const barWidth = (timeLeft / 30) * 100;
        document.getElementById('timer-bar').style.width = barWidth + "%";
    }

    function timeOut() {
        const feedback = document.getElementById('feedback-msg');
        feedback.style.display = "block";
        feedback.innerHTML = `<i class="fas fa-hourglass-end"></i> <b>หมดเวลา!</b> ข้อนี้ไม่ได้คะแนน`;
        feedback.className = "feedback wrong";
        endQuestion();
    }

    function cleanSQL(str) {
        return str.toLowerCase().replace(/[\n\r]/g, ' ').replace(/\s+/g, ' ').replace(/;\s*$/, '').trim();
    }

    function processAnswer() {
        clearInterval(timerInterval);
        const input = cleanSQL(document.getElementById('sql-input').value);
        const q = questions[currentQ];
        const feedback = document.getElementById('feedback-msg');
        feedback.style.display = "block";

        if (input === cleanSQL(q.answer)) {
            score += 10;
            document.getElementById('current-score').innerText = score;
            feedback.innerHTML = `<i class="fas fa-check-circle"></i> <b>ถูกต้อง!</b> ได้รับ 10 คะแนน`;
            feedback.className = "feedback correct";
            confetti({ particleCount: 30, spread: 50, origin: { y: 0.8 } });
        } else {
            feedback.innerHTML = `<i class="fas fa-times-circle"></i> <b>ผิด!</b> คำตอบคือ: <code style="background:#fff; padding:2px 5px;">${q.answer}</code>`;
            feedback.className = "feedback wrong";
        }
        endQuestion();
    }

    function endQuestion() {
        document.getElementById('sql-input').disabled = true;
        document.getElementById('run-btn').classList.add('hidden');
        document.getElementById('skip-btn').classList.add('hidden');
        if (currentQ < questions.length - 1) {
            document.getElementById('next-btn').classList.remove('hidden');
        } else {
            document.getElementById('finish-btn').classList.remove('hidden');
        }
    }

    function nextQuestion() {
        currentQ++;
        if (currentQ < questions.length) {
            loadQuestion();
        } else {
            showResults();
        }
    }

    function confirmReset() {
        if (confirm("ต้องการล้างคะแนนและเริ่มทำใหม่ตั้งแต่ข้อแรกหรือไม่?")) {
            score = 0;
            currentQ = 0;
            document.getElementById('current-score').innerText = "0";
            loadQuestion();
        }
    }

    function showResults() {
        document.getElementById('quiz-area').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('final-score-val').innerText = score;
        document.getElementById('congrats-text').innerText = `คุณ ${studentData.name} ทำคะแนนรวมได้ยอดเยี่ยม!`;
        updateLeaderboard();
        if(score >= 70) confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    }

    function updateLeaderboard() {
        const board = document.getElementById('leaderboard-body');
        const dummy = [
            { no: "12", name: "สมชาย เรียนดี", score: 100 },
            { no: studentData.no, name: studentData.name, score: score, isUser: true },
            { no: "05", name: "วิภา ขยันเรียน", score: 90 }
        ];
        dummy.sort((a, b) => b.score - a.score);
        board.innerHTML = dummy.map((s, i) => `
            <tr class="${s.isUser ? 'highlight-row' : ''}">
                <td>${i + 1}</td><td>${s.no}</td><td>${s.name}</td><td>${s.score}</td>
            </tr>
        `).join('');
    }
</script>
</body>
</html>
