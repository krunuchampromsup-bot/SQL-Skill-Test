<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL VIEW Master Class - T.Nuch Smart Com</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #1e40af;
            --secondary: #64748b;
            --accent: #10b981;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #1e293b;
            --syntax-bg: #1e293b;
            --border: #e2e8f0;
            --gold: #f59e0b;
            --error: #ef4444;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            line-height: 1.6;
        }

        .container { max-width: 900px; margin: auto; padding: 40px 20px; }

        .edu-header { text-align: center; margin-bottom: 30px; }
        .edu-header h1 { color: var(--primary); font-size: 2.2rem; margin: 0; }

        .box {
            background: var(--card);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid var(--border);
            animation: fadeIn 0.5s ease;
        }

        /* Tab System */
        .tab-container {
            display: flex; gap: 5px; margin-bottom: 20px;
            background: #e2e8f0; padding: 5px; border-radius: 10px;
        }
        .tab-btn {
            flex: 1; padding: 10px; border: none; background: none;
            font-family: 'Prompt'; cursor: pointer; border-radius: 8px;
            transition: 0.3s; color: var(--secondary); font-weight: 500;
        }
        .tab-btn.active { background: var(--primary); color: white; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .syntax-box {
            background: var(--syntax-bg); padding: 20px; border-radius: 10px;
            border-left: 5px solid var(--primary); font-family: 'Consolas', monospace;
            color: #e2e8f0; line-height: 1.5; margin: 15px 0;
        }

        .keyword { color: #f472b6; font-weight: bold; }
        .variable { color: #60a5fa; }

        .table-sim {
            width: 100%; border-collapse: collapse; margin: 15px 0;
            background: white; border-radius: 8px; overflow: hidden;
            font-size: 0.9rem; border: 1px solid var(--border);
        }
        .table-sim th { background: #f8fafc; color: var(--primary); padding: 12px; text-align: left; border-bottom: 2px solid var(--border); }
        .table-sim td { padding: 12px; border-bottom: 1px solid var(--border); }

        .btn {
            padding: 12px 25px; border-radius: 8px; border: none;
            font-family: 'Prompt'; font-weight: 600; cursor: pointer; transition: 0.3s;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary { background: var(--primary); color: white; width: 100%; }
        .btn-success { background: var(--accent); color: white; margin-top: 10px; }

        textarea {
            width: 100%; height: 100px; padding: 15px; border-radius: 8px;
            border: 2px solid var(--border); margin: 10px 0; font-family: 'Consolas', monospace; 
            box-sizing: border-box; font-size: 1rem; outline: none; resize: vertical;
        }
        textarea:focus { border-color: var(--primary); }

        .feedback { margin-top: 15px; padding: 15px; border-radius: 8px; display: none; }
        .feedback.correct { background: #f0fdf4; color: #166534; display: block; border: 1px solid #bbf7d0; }
        .feedback.wrong { background: #fef2f2; color: #991b1b; display: block; border: 1px solid #fecaca; }

        .leaderboard-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .leaderboard-table th { background: var(--primary); color: white; padding: 15px; }
        .leaderboard-table td { padding: 15px; border-bottom: 1px solid var(--border); text-align: center; }
        .highlight-row { background: #f0fdf4; font-weight: bold; }

        .hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="edu-header">
        <h1><i class="fas fa-database"></i> SQL VIEW Master Class</h1>
        <p>บทเรียนโต้ตอบ: สร้างและจัดการตารางเสมือน โดย ครูนุช Smart Com</p>
    </div>

    <div id="lesson-area" class="box">
        <div class="tab-container">
            <button class="tab-btn active" onclick="openTab(event, 'tab-create')">1. CREATE</button>
            <button class="tab-btn" onclick="openTab(event, 'tab-insert')">2. INSERT</button>
            <button class="tab-btn" onclick="openTab(event, 'tab-update')">3. UPDATE</button>
            <button class="tab-btn" onclick="openTab(event, 'tab-delete')">4. DELETE/DROP</button>
        </div>

        <div id="tab-create" class="tab-content active">
            <h2>การสร้างตารางเสมือน (CREATE VIEW)</h2>
            <p>VIEW คือตารางสมมติที่เก็บคำสั่ง SELECT ไว้ เพื่อให้เรียกใช้งานข้อมูลที่ซับซ้อนได้ง่ายขึ้น</p>
            <div class="syntax-box">
                <span class="keyword">CREATE VIEW</span> <span class="variable">view_name</span> <span class="keyword">AS</span><br>
                <span class="keyword">SELECT</span> column1, column2 FROM table_name <span class="keyword">WHERE</span> condition;
            </div>
        </div>

        <div id="tab-insert" class="tab-content">
            <h2>การเพิ่มข้อมูล (INSERT VIEW)</h2>
            <p>เราสามารถ INSERT ข้อมูลผ่าน VIEW ได้ หาก VIEW นั้นดึงมาจากตารางหลักเพียงตารางเดียว</p>
            <div class="syntax-box">
                <span class="keyword">INSERT INTO</span> <span class="variable">view_name</span> (col1, col2) <span class="keyword">VALUES</span> (val1, val2);
            </div>
        </div>

        <div id="tab-update" class="tab-content">
            <h2>การแก้ไขข้อมูล (UPDATE VIEW)</h2>
            <div class="syntax-box">
                <span class="keyword">UPDATE</span> <span class="variable">view_name</span> <span class="keyword">SET</span> column = value <span class="keyword">WHERE</span> condition;
            </div>
        </div>

        <div id="tab-delete" class="tab-content">
            <h2>การลบ (DELETE / DROP)</h2>
            <p><b>DELETE:</b> ลบข้อมูลในตารางหลักผ่าน VIEW</p>
            <p><b>DROP VIEW:</b> ลบตัว VIEW ออกจากระบบ (ไม่กระทบข้อมูลในตารางหลัก)</p>
        </div>

        <button class="btn btn-primary" onclick="startQuiz()" style="margin-top:20px;">
            <i class="fas fa-terminal"></i> เข้าสู่โหมดปฏิบัติการ SQL (10 ภารกิจ)
        </button>
    </div>

    <div id="quiz-area" class="hidden">
        <div class="box">
            <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color:var(--primary); margin:0;"><i class="fas fa-code"></i> Mission <span id="q-number">1</span>/10</h2>
                <div style="font-weight:bold; font-size: 1.2rem; color: var(--gold);">
                    <i class="fas fa-star"></i> Score: <span id="current-score">0</span>
                </div>
            </div>

            <div id="q-container">
                <div id="question-text" style="font-size: 1.1rem; margin-bottom: 15px;"></div>
                
                <div id="table-preview" class="hidden">
                    <p><small><i class="fas fa-table"></i> ข้อมูลที่ได้จากคำสั่งของคุณ:</small></p>
                    <div id="simulated-result"></div>
                </div>

                <textarea id="sql-input" placeholder="พิมพ์คำสั่ง SQL ที่นี่... (เช่น CREATE VIEW ...)"></textarea>
                
                <div id="feedback-msg" class="feedback"></div>

                <button id="run-btn" class="btn btn-success" onclick="processAnswer()">
                    <i class="fas fa-play"></i> Run Command
                </button>

                <button id="next-btn" class="btn btn-primary hidden" onclick="nextQuestion()" style="margin-top:20px;">
                    Next Mission <i class="fas fa-arrow-right"></i>
                </button>
                
                <button id="finish-btn" class="btn btn-primary hidden" onclick="showResults()" style="margin-top:20px; background: var(--accent);">
                    <i class="fas fa-check-double"></i> ดูผลการเรียนทั้งหมด
                </button>
            </div>
        </div>
    </div>

    <div id="result-screen" class="hidden">
        <div class="box" style="text-align: center;">
            <h2 style="color: var(--primary);"><i class="fas fa-award"></i> Mission Accomplished!</h2>
            <div style="font-size: 5rem; color: var(--accent); font-weight: bold; margin: 10px 0;" id="final-score-val">0</div>
            <p style="font-size: 1.2rem;">ยินดีด้วย! คุณเชี่ยวชาญการใช้ SQL VIEW แล้ว</p>
        </div>

        <div class="box">
            <h2 style="text-align: center; color: var(--gold); margin-bottom: 20px;">
                <i class="fas fa-trophy"></i> Classroom Leaderboard
            </h2>
            <table class="leaderboard-table">
                <thead>
                    <tr><th>Rank</th><th>Name</th><th>Score</th></tr>
                </thead>
                <tbody id="leaderboard-body">
                    </tbody>
            </table>
            <button class="btn btn-primary" style="margin-top:30px;" onclick="location.reload()">
                <i class="fas fa-redo"></i> กลับไปหน้าบทเรียน
            </button>
        </div>
    </div>
</div>

<script>
    let currentQ = 0;
    let score = 0;

    const questions = [
        {
            task: "จงสร้าง VIEW ชื่อ <b>active_users</b> จากตาราง users โดยเลือกทุกคอลัมน์ที่ status = 'active'",
            keywords: ["create view", "active_users", "as", "select", "from", "users", "where", "status", "active"],
            table: "<tr><th>id</th><th>name</th><th>status</th></tr><tr><td>1</td><td>Somsak</td><td>active</td></tr><tr><td>2</td><td>Wichai</td><td>active</td></tr>"
        },
        {
            task: "จงเขียนคำสั่งเรียกดูข้อมูล <b>ทั้งหมด</b> จาก VIEW ที่ชื่อ <b>active_users</b>",
            keywords: ["select", "*", "from", "active_users"],
            table: "<tr><th>id</th><th>name</th><th>status</th></tr><tr><td>1</td><td>Somsak</td><td>active</td></tr><tr><td>2</td><td>Wichai</td><td>active</td></tr>"
        },
        {
            task: "จงสร้าง VIEW ชื่อ <b>high_price</b> จากตาราง products เลือกทุกคอลัมน์ที่ price > 1000",
            keywords: ["create view", "high_price", "as", "select", "from", "products", "where", "price", "1000"],
            table: "<tr><th>p_id</th><th>name</th><th>price</th></tr><tr><td>101</td><td>Monitor</td><td>4500</td></tr>"
        },
        {
            task: "จงเพิ่มข้อมูลชื่อ 'Notebook' ราคา 25000 ลงใน VIEW <b>high_price</b> (คอลัมน์ name, price)",
            keywords: ["insert into", "high_price", "name", "price", "values", "notebook", "25000"],
            msg: "บันทึกข้อมูลเข้าสู่ตารางหลักผ่าน View สำเร็จ!"
        },
        {
            task: "จงแก้ไขราคา (price) ใน VIEW <b>high_price</b> เป็น 1500 สำหรับสินค้าที่มี id = 5",
            keywords: ["update", "high_price", "set", "price", "1500", "where", "id", "5"],
            msg: "แก้ไขข้อมูลสำเร็จ! (1 row updated)"
        },
        {
            task: "จงลบข้อมูลออกจาก VIEW <b>active_users</b> สำหรับผู้ใช้ที่มี id = 10",
            keywords: ["delete from", "active_users", "where", "id", "10"],
            msg: "ลบข้อมูลสำเร็จ! ข้อมูลในตาราง users จะถูกลบไปด้วย"
        },
        {
            task: "หากต้องการลบตารางเสมือน <b>active_users</b> ออกจากฐานข้อมูล ต้องใช้คำสั่งใด",
            keywords: ["drop view", "active_users"],
            msg: "ลบ VIEW 'active_users' ออกจากระบบแล้ว"
        },
        {
            task: "จงสร้าง VIEW ชื่อ <b>staff_list</b> โดยเลือกเฉพาะคอลัมน์ <b>name</b> จากตาราง employees",
            keywords: ["create view", "staff_list", "as", "select", "name", "from", "employees"],
            table: "<tr><th>name</th></tr><tr><td>John</td></tr><tr><td>Jane</td></tr>"
        },
        {
            task: "จงเขียนคำสั่ง SELECT ข้อมูลจาก VIEW <b>staff_list</b> โดยเรียงชื่อ (ORDER BY name)",
            keywords: ["select", "from", "staff_list", "order by", "name"],
            table: "<tr><th>name</th></tr><tr><td>Jane</td></tr><tr><td>John</td></tr>"
        },
        {
            task: "จงใช้คำสั่งลบตารางเสมือน <b>high_price</b> ออกจากระบบฐานข้อมูล",
            keywords: ["drop view", "high_price"],
            msg: "ลบ VIEW 'high_price' ออกจากระบบถาวร"
        }
    ];

    function openTab(evt, tabName) {
        let content = document.getElementsByClassName("tab-content");
        for (let i = 0; i < content.length; i++) content[i].classList.remove("active");
        let btns = document.getElementsByClassName("tab-btn");
        for (let i = 0; i < btns.length; i++) btns[i].classList.remove("active");
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
    }

    function startQuiz() {
        document.getElementById('lesson-area').classList.add('hidden');
        document.getElementById('quiz-area').classList.remove('hidden');
        loadQuestion();
    }

    function loadQuestion() {
        const q = questions[currentQ];
        document.getElementById('q-number').innerText = currentQ + 1;
        document.getElementById('question-text').innerHTML = q.task;
        document.getElementById('sql-input').value = "";
        document.getElementById('feedback-msg').className = "feedback";
        document.getElementById('table-preview').classList.add('hidden');
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('run-btn').classList.remove('hidden');
    }

    function processAnswer() {
        const input = document.getElementById('sql-input').value.toLowerCase();
        const feedback = document.getElementById('feedback-msg');
        const q = questions[currentQ];
        
        // ตรวจสอบ Keywords ทั้งหมดที่ต้องมี
        const isCorrect = q.keywords.every(k => input.includes(k.toLowerCase()));

        if (isCorrect) {
            score += 10;
            document.getElementById('current-score').innerText = score;
            feedback.innerHTML = `<i class="fas fa-check-circle"></i> <b>ถูกต้อง!</b> คำสั่ง SQL ทำงานสำเร็จ`;
            feedback.className = "feedback correct";
            document.getElementById('run-btn').classList.add('hidden');

            // แสดงตารางจำลอง หรือข้อความ Success
            if (q.table) {
                document.getElementById('table-preview').classList.remove('hidden');
                document.getElementById('simulated-result').innerHTML = `<table class="table-sim">${q.table}</table>`;
            } else if (q.msg) {
                feedback.innerHTML += `<br><small>${q.msg}</small>`;
            }

            if (currentQ < questions.length - 1) {
                document.getElementById('next-btn').classList.remove('hidden');
            } else {
                document.getElementById('finish-btn').classList.remove('hidden');
            }
            
            // Effect
            confetti({ particleCount: 40, spread: 50, origin: { y: 0.8 } });

        } else {
            feedback.innerHTML = `<i class="fas fa-times-circle"></i> <b>ผิดพลาด:</b> ไวยากรณ์ไม่ครบถ้วน กรุณาตรวจสอบชื่อ VIEW และคีย์เวิร์ด SQL`;
            feedback.className = "feedback wrong";
        }
    }

    function nextQuestion() {
        currentQ++;
        loadQuestion();
    }

    function showResults() {
        document.getElementById('quiz-area').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('final-score-val').innerText = score;
        updateLeaderboard();
        if(score >= 80) confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
    }

    function updateLeaderboard() {
        const board = document.getElementById('leaderboard-body');
        const students = [
            { name: "เด็กชายสมชาย เรียนดี", score: 100 },
            { name: "คุณ (You)", score: score, isUser: true },
            { name: "เด็กหญิงวิภา ขยันเรียน", score: 90 },
            { name: "เด็กชายมานะ อดทน", score: 80 }
        ];
        students.sort((a, b) => b.score - a.score);
        board.innerHTML = students.map((s, i) => `
            <tr class="${s.isUser ? 'highlight-row' : ''}">
                <td>${i + 1}</td>
                <td>${s.name}</td>
                <td>${s.score}</td>
            </tr>
        `).join('');
    }
</script>
</body>
</html>
